<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>quartz-list</title>
    <link href="/qqrobot/static/css/quartz/list.css" rel="stylesheet">
    <link href="/qqrobot/static/bootstrap/bootstrap-5.1.3-dist/css/bootstrap.min.css" rel="stylesheet">
    <!--<link href="/qqrobot/static/bootstrap/bootstrap-5.1.3-dist/css/bootstrap-grid.min.css" rel="stylesheet">-->
    <!--<link href="/qqrobot/static/bootstrap/bootstrap-5.1.3-dist/css/bootstrap-reboot.min.css" rel="stylesheet">-->
    <!--<link href="/qqrobot/static/bootstrap/bootstrap-5.1.3-dist/css/bootstrap-utilities.min.css" rel="stylesheet">-->
    <link href="/qqrobot/static/bootstrap/bootstrap-table-1.20.2-dist/bootstrap-table.min.css" rel="stylesheet">
    <link href="/qqrobot/static/bootstrap/bootstrap-table-1.20.2-dist/themes/bootstrap-table/bootstrap-table.min.css" rel="stylesheet">
    <link href="/qqrobot/static/bootstrap/bootstrap-table-1.20.2-dist/extensions/filter-control/bootstrap-table-filter-control.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css">
</head>
<body>
    <!-- 导航栏 -->
    <nav class="site-header sticky-top py-1">
        <div class="container d-flex flex-column flex-md-row justify-content-between">
            <div class="nav navbar-header">
                <a class="py-2" href="/qqrobot/index">
                    <svg xmlns="http://www.w3.org/2000/svg" width="35" height="35" fill="currentColor" class="bi bi-terminal-dash" viewBox="0 0 16 16">
                        <path d="M2 3a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h5.5a.5.5 0 0 1 0 1H2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h11a2 2 0 0 1 2 2v4a.5.5 0 0 1-1 0V4a1 1 0 0 0-1-1H2Z"/>
                        <path d="M3.146 5.146a.5.5 0 0 1 .708 0L5.177 6.47a.75.75 0 0 1 0 1.06L3.854 8.854a.5.5 0 1 1-.708-.708L4.293 7 3.146 5.854a.5.5 0 0 1 0-.708ZM5.5 9a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1H6a.5.5 0 0 1-.5-.5ZM16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Zm-5.5 0a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 0-1h-3a.5.5 0 0 0-.5.5Z"/>
                    </svg>
                    QQRobot DashBoard
                </a>
            </div>
            <div class="nav navbar-left">
                <a class="py-2 d-none d-md-inline-block" href="/qqrobot/index">Index</a>
                <a class="py-2 d-none d-md-inline-block" href="/qqrobot/quartz">QuartzTask</a>
                <a class="py-2 d-none d-md-inline-block" href="/qqrobot/druid" target="_blank">Druid</a>
            </div>
        </div>
    </nav>

    <div class="table-responsive">
        <div id="toolbar">
            <button id="addTask" class="btn btn-danger">
                <i class="fa fa-trash"></i> 新建Task
            </button>
        </div>
        <table
                id="table"
                class="table table-hover table-bordered table-striped table-condensed"
                data-toolbar="#toolbar"
                data-toggle="table"
                data-locale="zh-CN"
                data-striped="true"
                data-search="false"
                data-show-refresh="true"
                data-show-toggle="true"
                data-side-pagination="server"
                data-pagination="true"
                data-server-sort="false"
                data-show-columns="true"
                data-show-columns-search="true"
                data-show-columns-toggle-all="true"
                data-minimum-count-columns="2"
                data-filter-control="true"
                data-show-search-clear-button="true"
                data-page-number="1"
                data-page-size="10"
                data-page-list="[10, 25, 50, 100, all]"
                data-show-footer="false"
                data-flat="true"
                data-escape="true"
                data-cache="false"
                data-detail-view="true"
                data-detail-formatter="detailFormatter"
                data-id-field="taskName taskGroup"
                data-select-item-name="taskName taskGroup"

                data-url="/qqrobot/quartz/list"
                data-method="post"
                data-query-params="queryParams"
                data-response-handler="responseHandler">
            <thead>
            <tr>
                <th data-field="taskName" data-sortable="true" data-filter-control="input" data-align="center" data-valign="center">
                    任务名称
                </th>
                <th data-field="taskGroup" data-sortable="true" data-filter-control="input" data-align="center" data-valign="center">
                    任务分组
                </th>
                <th data-field="taskDescription" data-sortable="false" data-filter-control="input" data-align="center" data-valign="center">
                    任务描述
                </th>
                <th data-field="taskClass" data-sortable="false" data-visible="false" data-filter-control="input" data-align="center" data-valign="center">
                    全限定类名
                </th>
                <th data-field="taskCron" data-sortable="false" data-filter-control="input" data-align="center" data-valign="center">
                    cron表达式
                </th>
                <th data-field="status" data-sortable="true" data-filter-control="select" data-filter-data="var:status_select" data-formatter="statusFormatter" data-align="center" data-valign="center">
                    任务状态
                </th>
                <th data-field="pauseTimeLimit" data-sortable="false" data-align="center" data-valign="center">
                    暂停时间期限
                </th>
                <th data-field="createUser" data-sortable="false" data-filter-control="input" data-align="center" data-valign="center">
                    创建者
                </th>
                <th data-field="createTime" data-sortable="false" data-align="center" data-valign="center">
                    创建时间
                </th>
                <th data-field="updateUser" data-sortable="false" data-filter-control="input" data-align="center" data-valign="center">
                    最后更新者
                </th>
                <th data-field="updateTime" data-sortable="false" data-align="center" data-valign="center">
                    最后更新时间
                </th>
                <th data-field="operate" data-sortable="false" data-events="window.operateEvents" data-formatter="operateFormatter" data-align="center" data-valign="center">
                    操作
                </th>
            </tr>
            </thead>
        </table>
    </div>

    <script src="/qqrobot/static/js/jquery/jquery-3.6.0.min.js"></script>
    <!--<script src="/qqrobot/static/bootstrap/bootstrap-5.1.3-dist/js/bootstrap.min.js"></script>-->
    <!--<script src="/qqrobot/static/bootstrap/bootstrap-5.1.3-dist/js/bootstrap.bundle.min.js"></script>-->
    <script src="/qqrobot/static/bootstrap/bootstrap-table-1.20.2-dist/bootstrap-table.min.js"></script>
    <script src="/qqrobot/static/bootstrap/bootstrap-table-1.20.2-dist/locale/bootstrap-table-zh-CN.min.js"></script>
    <script src="/qqrobot/static/bootstrap/bootstrap-table-1.20.2-dist/themes/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="/qqrobot/static/bootstrap/bootstrap-table-1.20.2-dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>
    <script>
        var $table = $('#table');
        var $addTask = $('#addTask');
        var selections = [];

        var status_select = {
            "0": "0 - 停止",
            "1": "1 - 激活",
            "2": "2 - 暂停"
        };

        function queryParams(params) {
            delete params.search;
            delete params.sort;
            delete params.order;

            console.log('=====queryParams=====');
            console.log(params);
            return params;
        }

        function responseHandler(res) {
            console.log('=====responseHandler=====');
            console.log(res);
            return res;
        }

        function detailFormatter(index, row) {
            let html = [];
            $.each(row, function (key, value) {
                html.push('<p><b>' + key + ':</b> ' + value + '</p>')
            });
            return html.join('');
        }

        function statusFormatter(value, row) {
            return status_select[value];
        }

        function operateFormatter(value, row, index) {
            return [
                '<a class="like" href="javascript:void(0)" title="Like">',
                '<i class="fa fa-heart"></i>',
                '</a>  ',
                '<a class="remove" href="javascript:void(0)" title="Remove">',
                '<i class="fa fa-trash"></i>',
                '</a>'
            ].join('');
        }

        window.operateEvents = {
            'click .like': function (e, value, row, index) {
                alert('You click like action, row: ' + JSON.stringify(row))
            },
            'click .remove': function (e, value, row, index) {
                $table.bootstrapTable('remove', {
                    field: 'id',
                    values: [row.id]
                })
            }
        }

        function initTable() {
            $table.bootstrapTable();
            // $table.on('check.bs.table uncheck.bs.table ' +
            //     'check-all.bs.table uncheck-all.bs.table',
            //     function () {
            //         //$remove.prop('disabled', !$table.bootstrapTable('getSelections').length)
            //
            //         // save your data, here just save the current page
            //         //selections = getIdSelections()
            //         // push or splice the selections if you want to save all data selections
            //     })
            // 打印所有表格事件
            // $table.on('all.bs.table', function (e, name, args) {
            //     console.log(name, args)
            // })
            // $remove.click(function () {
            //     var ids = getIdSelections()
            //     $table.bootstrapTable('remove', {
            //         field: 'id',
            //         values: ids
            //     })
            //     $remove.prop('disabled', true)
            // })
        }

        $(function() {
            initTable();

            // $('select').change(function () {
            //     console.log($(this).val());
            // })
        })
    </script>
</body>
</html>